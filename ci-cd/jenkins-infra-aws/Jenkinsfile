pipeline {
    agent any
    tools {
        jdk 'JDK-21'
        nodejs 'NODE-18'
    }
    environment {
        DOCKER_IMAGE='simple-react-app'
    }
    options {
        timeout(time:30, unit:'MINUTES')
    }
    stages {
        stage('OS Check'){
            steps{
                sh "cat /etc/os-release | sed -n 's/^PRETTY_NAME=\"\\(.*\\)\"/\\1/p'"
                sh "hostnamectl | awk NR==7"
            }
        }
        stage('Software Check'){
            steps{
                sh '''
                    echo $(node -v)
                    echo $(java -version 2>&1 | sed -n '1p')
                '''
            }
        }
        stage('Docker Version') {
            steps {
                script {
                    
                    sh 'ls -la'

                    
                    if (fileExists('devops/ci-cd/jenkins-infra-aws/docker_version.sh')) {
                        
                        sh 'chmod +x devops/ci-cd/jenkins-infra-aws/docker_version.sh'

                        
                        sh './devops/ci-cd/jenkins-infra-aws/docker_version.sh'
                    } else {
                        error("docker_version.sh not found in the workspace!")
                    }
                }
             }
        }
        // stage('Checkout') {
        //     steps {
        //         checkout scm
        //     }
        // }
        // stage('Run Docker Check'){
        //     steps{
        //         script{
        //             def dockerVersion = sh(script: '''
        //                /bin/bash ./docker_version.sh
        //             ''', returnStdout: true).trim()
                    
        //             echo "$dockerVersion"
        //         }
        //     }
        // }
    }
}